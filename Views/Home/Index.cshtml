@model AirBB.Models.ViewModels.ResidenceViewModel
@{
    ViewData["Title"] = "Home";
}

<div class="container-fluid">
    <div class="row">
        <!-- Left Panel: Filtering -->
        <div class="col-md-3">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">Find Your Stay</h5>
                </div>
                <div class="card-body">
                    <form asp-action="Index" method="get">
                        <!-- Where -->
                        <div class="mb-3">
                            <label class="form-label">Where</label>
                            <select asp-for="ActiveWhere" class="form-select">
                                <option value="all">All Locations</option>
                                @foreach (var location in Model.Locations)
                                {
                                    <option value="@location.LocationID">@location.Name</option>
                                }
                            </select>
                        </div>
                        
                        <!-- When -->
                        <div class="mb-3">
                            <label class="form-label" asp-for="ActiveWhen">When</label>
                            <input type="text" class="form-control" asp-for="ActiveWhen" id="daterange" 
                                   name="ActiveWhen" value="@Model.ActiveWhen" 
                                   placeholder="MM/DD/YYYY - MM/DD/YYYY" />
                        </div>
                        
                        <!-- Who -->
                        <div class="mb-3">
                            <label class="form-label" asp-for="ActiveWho">Number of Guests</label>
                            <input asp-for="ActiveWho" type="number" class="form-control" />
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Search</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Right Panel: Results -->
        <div class="col-md-9">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">Available Properties</h5>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        @foreach (var residence in Model.FilteredResidences)
                        {
                            <div class="col-md-6 col-lg-4">
                                <div class="card h-100 shadow-sm">
                                    <img src="~/images/@residence.ResidencePicture" 
                                         class="card-img-top residence-img" 
                                         alt="@residence.Name">
                                    <div class="card-body">
                                        <h5 class="card-title">@residence.Name</h5>
                                        <p class="card-text">
                                            <i class="fas fa-map-marker-alt"></i> @residence.Location.Name
                                        </p>
                                        @if (Model.ResidenceAvailability.ContainsKey(residence.ResidenceID) && Model.ResidenceAvailability[residence.ResidenceID])
                                        {
                                            <a asp-action="Details" 
                                               asp-route-id="@residence.ResidenceID" 
                                               class="btn btn-outline-primary stretched-link">
                                                View Details
                                            </a>
                                        }
                                        else
                                        {
                                            <div class="alert alert-warning mb-0 text-center" role="alert">
                                                Not available for selected dates
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>